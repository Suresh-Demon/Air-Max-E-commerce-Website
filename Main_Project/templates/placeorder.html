{% extends 'base.html' %}

{% load static %}

{% block 'main' %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <style>

        .container-xxl {
            margin-top: 100px;
        }


        .cart-container {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }


        .cart-table th,
        .cart-table td {
            vertical-align: middle;
        }

        .cart-table img {
            border-radius: 5px;
        }

        .card {
            border-radius: 10px;
        }

        .btn-danger {
            transition: all 0.3s ease-in-out;
        }

        .btn-danger:hover {
            background-color: #dc3545;
            transform: scale(1.1);
        }

        .btn-success {
            transition: all 0.3s ease-in-out;
        }

        .btn-success:hover {
            background-color: #28a745;
            transform: scale(1.05);
        }

        @media (max-width: 768px) {

            .cart-table th,
            .cart-table td {
                font-size: 14px;
            }

            .cart-table img {
                width: 50px;
                height: 50px;
            }

            .cart-container {
                padding: 10px;
            }
        }
    </style>
</head>

<body>

    <div class="container-xxl">
        <div class="row">

            <div class="col-md-8">
                <div class="cart-container p-3 shadow-sm rounded bg-white">
                    {% for x in products %}
                    <table class="table cart-table table-hover text-center">
                        <thead class="table-dark">
                            <tr>
                                <th>Product</th>
                                <th>Name</th>
                                <th>Price</th>
                                <th>Quantity</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <img src="{{ x.pid.pimage.url }}" alt="{{ x.pid.name }}" class="img-fluid"
                                        style="width: 120px; height: 120px;">
                                </td>
                                <td>{{ x.pid.name }}</td>
                                <td>&#8377; {{ x.pid.price }}</td>
                                <!-- <td>
                                    <a href="/updateqty/0/{{x.id}}" class="btn btn-light">-</a>
                                    <input type="text" style="width: 30px; text-align: center;" value="{{x.qty}}"
                                        readonly>
                                    <a href="/updateqty/1/{{x.id}}" class="btn btn-light">+</a>
                                </td> -->
                                <td>
                                    <a href="/removeorder/{{x.id}}" class="btn btn-danger btn-sm">
                                        <i class="fas fa-trash"></i>
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    {% endfor %}
                </div>
            </div>


            <div class="col-md-4">

                <div class="card mb-4 shadow-sm">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0">User Details</h5>
                    </div>
                    <div class="card-body">
                        {% for x in products %}
                        {% if forloop.counter == 1 %}
                        <ul class="list-group">
                            <li class="list-group-item d-flex justify-content-between">
                                <strong>Customer Name:</strong>
                                <span>{{ x.uid.username }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between">
                                <strong>Email ID:</strong>
                                <span>{{ x.uemail.email }}</span>
                            </li>
                        </ul>
                        {% endif %}
                        {% endfor %}
                    </div>
                </div>


                <div class="card mb-4 shadow-sm">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0">Cart Total</h5>
                    </div>
                    <div class="card-body">
                        <ul class="list-group">
                            <li class="list-group-item d-flex justify-content-between">
                                <strong>Products ({{ n }} items):</strong>
                                <span>&#8377; {{ total }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between">
                                <strong>Total Amount:</strong>
                                <span class="text-success"><strong>&#8377; {{ total }}</strong></span>
                            </li>
                        </ul>
                        <div class="text-center mt-3">
                            <a href="/payment_success" class="text-center mt-3">
                                <button id="rzp-button1"
                                    style="border: 1px solid black; background-color: rgb(46, 46, 46); width: 120px; height: 40px;border-radius: 5px;color: white;"
                                    class="btn btn-success w-100">Proceed to Pay</button>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script>
        var options = {
            "key": "rzp_test_t3q4uoB0Hc14De",
            "amount": 100, 
            "currency": "INR",
            "name": "Estore",
            "description": "Test Transaction",
            "image": "https://example.com/your_logo",
            "order_id": "{{data.id}}",
            "handler": function (response) {
                window.location.href = "http://127.0.0.1:8000/"
                // window.location.alert("Payment Successful! Order placed.")
                // alert(response.razorpay_order_id);
                // alert(response.razorpay_signature);

            },
            "prefill": {
                "name": "Suresh",
                "email": "suresh@gmail.com",
                "contact": "8433689342"
            },
            "notes": {
                "address": "Razorpay Corporate Office"
            },
            "theme": {
                "color": "#3399cc"
            }

        };
        var rzp1 = new Razorpay(options);
        rzp1.on('payment.failed', function (response) {
            alert(response.error.code);
            alert(response.error.description);
            alert(response.error.source);
            alert(response.error.step);
            alert(response.error.reason);
            alert(response.error.metadata.order_id);
            alert(response.error.metadata.payment_id);
        });
        document.getElementById('rzp-button1').onclick = function (e) {
            rzp1.open();
            e.preventDefault();
        },


        {
            "razorpay_payment_id": "{{x.oid}}",
            "razorpay_order_id": "{{x.order_id}}",
            "razorpay_signature": "9ef4dffbfd84f1318f6739a3ce19f9d85851857ae648f114332d8401e0949a3d"
        }
    </script>


    {% endblock 'main' %}
</body>

</html>